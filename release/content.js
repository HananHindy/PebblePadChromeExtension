/* PebblePadExtension V1.0 - Copyright (c) 2019 HananHindy */
chrome.runtime.onMessage.addListener(function(e,d,a){if("clicked_browser_action"===e.message){var i=window.location.toString(),n=i.indexOf("&pageId");i=i.substring(0,n)+"&pageId=";for(var r=["#d3bedd","#9cdcf8","#a7d4d9","#bac9e6"],l=["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],t=0,c=document.getElementsByTagName("navigation-item"),o=c.length,s={name:"PDP",children:[]},h=[],g=-1,f=0;f<o;f++){var m=JSON.parse(c[f].attributes["item-data"].value),p=m.Children.length,u=m.PageTitle,b=m.PageId,v={name:u,tooltip:u,color:g>=0?r[g]:l[t],children:[]};if(p>0){for(var P=0;P<p;P++){u=m.Children[P].PageTitle,b=m.Children[P].PageId;var I={name:P+1,tooltip:u,color:g>=0?r[g]:l[t],url:i+b,size:1,children:[]};v.children.push(I)}g>=0?h[g].children.push(v):(s.children.push(v),t++)}else if(-1!=u.indexOf("Domain")){g++;var _={};_.name=u.replace("Domain ",""),_.tooltip=u,_.color=g>=0?r[g]:"#99ccff",_.url=i+b,_.children=[],h.push(_)}}g>=0&&(s.children=h),s.children.length>0&&chrome.runtime.sendMessage({message:"open_pdp_page",data:s})}});